# LOVE20 Extension - Pool（矿池扩展协议）

基于 LOVE20 扩展协议的 矿池扩展合约。

让一个行动，可以通过矿池的方式来参与行动铸币。

矿工可自由加入退出所选矿池，进行可验证的共识行动，矿池主每轮对矿工进行验证，矿工获得行动激励，矿池主获得矿池服务激励，支持此行动的治理者，可以监督矿池主，通过不信任投票降低矿池整体收益。

## 初始参数

### 最小治理票占比

持有 >= 最小治理票占比 的治理者，有资格成为矿池主创建矿池

### 容量倍数

- 单个矿池最小容量：已铸造代币总量 \* 最小治理票占比 \* 容量倍数
- 矿池主累计矿池容量上限：已铸造代币总量 \* 矿池主治理票占比 \* 容量倍数

### 质押倍数

- 质押量 = 矿池容量 / 质押倍数
- 最大质押量：矿池主下所有矿池的累计质押量不超过：已铸造代币总量 \* 矿池主治理票占比 \* 容量倍数 / 质押倍数

### 矿工最大参与代币上限系数

- 单个矿工最大参与代币数 = 已铸造代币总量 / 矿工最大参与代币上限系数

## 治理者

### 不信任投票

完成非弃权票验证的治理者，可以在验证阶段对每个矿池进行不信任投票，最多不超过自己的验证票数，以惩罚未按照行动规则进行验证的矿池，降低矿池包括矿池主和矿工在内的整体可分配行动激励。

降低的比例 = 当轮累计获得的不信任票 / 当轮非弃权的行动验证总票数

## 矿池主

### 矿池创建

治理者可以创建一个或多个矿池成为矿池主，并设定

- 矿池说明：
- 佣金率：由市场竞争自由调节，值范围 0~100，对应 0%~100%
- 矿工最小参与量

其中只有矿池说明可更新修改。

矿池创建时，需无偿质押代币，决定矿池的最大容量

### 矿池扩容

矿池主可追加质押，增加矿池容量上限。矿工加入矿池时，如果超出矿池容量，将无法加入。

矿池容量 = 质押量 \* 质押倍数

### 矿池验证

每轮的验证阶段，矿池主基于行动的验证规则，验证自己管理的矿池中每个矿工的可验证共识行动，给予矿池验证票，决定每个矿工的铸币量。

每轮的验证阶段，下面 3 种交互情况任意情况发生，立即在交互前快照所在矿池待验证矿工地址与参与代币数（每轮只触发一次快照生成）

- 矿工加入矿池
- 矿工退出矿池
- 矿池主提交矿池验证

注意：

- 单个矿工获得的验证票不得超过其参与代币数量
- 所有矿工的验证票总数不得超过矿池参与代币总量
- 若当前轮次矿池主未提交有效的矿池验证，或所有矿工的验证票总数为 0，则自动放弃所有激励，分给其他矿池

### 矿池服务激励铸造

矿池主每轮铸造矿池服务激励，并同步销毁不信任票对应的矿池服务激励。

矿池服务激励 = 矿池实际铸币激励 \* 矿池服务费率

矿池理论铸币激励 = 矿池代币参与量 / 所有矿池代币参与总量 \* 行动铸币激励

矿池实际铸币激励 = 矿池理论铸币激励 \* （1 - 不信任票/ 当轮非弃权的行动验证总票数）

矿池激励销毁 = 矿池理论铸币激励 - 矿池实际铸币激励

### 矿池停止

矿池主在矿池创建后的下一轮开始，可随时停止矿池，并立即返还质押代币。

矿池停止后，矿工可继续领取之前未领取的行动铸币激励。

已停止的矿池，矿工无法加入，现有矿工也无法追加代币。

## 矿工

## 加入矿池

矿工可以通过矿池 id，将代币放入矿池进行挖矿

注意：同一个行动下，只能参与一个矿池的挖矿，不可以同时参与多个矿池。

## 铸造行动激励

矿工加入后，下一个阶段开始验证，验证后可铸造自己的行动激励

矿工铸造激励 = 矿工本轮得分 / 矿池总得分 \* 矿池实际铸币激励 \* （1-矿池服务费率）

注意：当矿池总得分为 0 时，所有激励自动分配给其他矿池

## 退出矿池

可随时退出矿池并立即返还累计参与的所有代币
